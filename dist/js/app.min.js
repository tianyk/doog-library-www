angular.module("doog.library-www",["ngRoute","ngResource","ngCookies","angular-cache"]).constant("LOGIN_URL","http://accounts.tykhome.com:3000/login/").factory("HttpInterceptor",["$q","$location","$log",function(e,r,o){var t={request:function(e){return e.headers.location=r.absUrl(),e},response:function(e){return e},requestError:function(e){return e},responseError:function(e){return e}};return t}]).factory("AuthInterceptor",["$rootScope","$q","$cookies","$location","$window","$timeout","$log","LOGIN_URL",function(e,r,o,t,n,a,c,s){return{request:function(e){return e.headers.location=t.absUrl(),e.headers=e.headers||{},c.info("X-AUTH-TOKEN",o.get("X-AUTH-TOKEN")),o.get("X-AUTH-TOKEN")&&(e.headers["X-AUTH-TOKEN"]=o.get("X-AUTH-TOKEN")),e},responseError:function(o){var t=o.status;if(401===t){var c=o.headers("location");c&&(c=encodeURIComponent(c)),n.location.href=s+(c?"?redirectURL="+c:"")}else 0!==t&&angular.isUndefined(o.data.errors)&&(o.data.text?e.errorKey=o.data.text:(e.showErrorMsg=!0,a(function(){e.showErrorMsg=!1},5e3)));return r.reject(o)}}}]).factory("authService",["$http",function(e){var r=[],o={ROLE_ADMIN:["/dashboard","/about-us","/authError"],ROLE_USER:["/usersettings","/usersettings/personal","/authError"]};return{userLoggedIn:function(){return!0},userHasRole:function(e){for(var o=0;o<r.length;o++)if(e==r[o])return!0;return!1},isUrlAccessibleForUser:function(e){for(var t=0;t<r.length;t++){var n=r[t],a=o[n];if(a)for(var c=0;c<a.length;c++)if(a[c]==e)return!0}return!1}}}]).config(["$httpProvider",function(e){e.defaults.headers.common["x-Requested-With"]="XMLHttpRequest",e.defaults.headers.common["X-Requested-By"]="AngularApp",e.interceptors.push("AuthInterceptor")}]).config(["$routeProvider","$locationProvider",function(e,r){e.when("/",{templateUrl:"/app/views/home.html",controller:"HomeController"}).when("/login",{templateUrl:"/app/views/login.html",controller:"LoginController"}).when("/help",{templateUrl:"/app/views/help.html",controller:"HelpController"}).when("/404",{templateUrl:"/app/views/404.html",controller:"NotFoundController"}).otherwise({redirectTo:"/404"})}]).run(["$rootScope","$location","$log","$interval","AuthService",function(e,r,o,t,n){var a;e.$on("page:fetch",function(){NProgress.remove(),NProgress.start(),t.cancel(a),a=t(function(){NProgress.inc()},500)}),e.$on("page:change",function(){t.cancel(a),NProgress.done()}),e.$on("$routeChangeStart",function(t,a,c){e.$emit("page:fetch"),o.info("$routeChangeStart"),n.userLoggedIn()||"login.html"===a.templateUrl||r.path("/login")}),e.$on("$routeChangeSuccess",function(r,t,n){e.$emit("page:change"),o.info("$routeChangeSuccess")}),e.$on("$routeChangeError",function(t,n,a,c){e.$emit("page:change"),o.error(n.templateUrl),r.path("/home")}),e.$on("doog.say",function(r,t){o.info(r.name+" "+t),e.$broadcast("doge.say","GO"),e.$emit("root:say")})}]);
angular.module("doog.library-www").controller("HelpController",["$scope","$log","$location","BookService",function(o,n,e,t){o.title="Help",o.$on("doog.say",function(){n.info("我听到 haha了。help.$scope")}),o.$on("doge.say",function(o,e){n.info(o.name+" "+e)}),o.$on("root:say",function(o,e){n.info(o.name+" "+e)}),o.next=function(){e.search({start:(new Date).getTime(),size:10})},o.load=function(){t.express(function(o){n.info(o.length)})}}]);
angular.module("doog.library-www").controller("HomeController",["$scope","$location","$log","BookService","UserService",function(o,n,e,t,a){o.title="Home",o.expressBooks=[],o.popularBooks=[],a.get({id:"7788"},function(n){o.user=n}),t.express(function(n){o.expressBooks=n}),t.popular(function(n){o.popularBooks=n}),o.load=function(){t.express(function(o){e.info(o.length)})},o.$on("$routeChangeStart",function(o,n,e){console.log("$scope $routeChangeStart")}),o.say=function(){o.$emit("doog.say","haha~")},o.$on("doog.say",function(){e.info("我听到 haha了。home.$scope")}),o.$on("doge.say",function(o,n){e.info(o.name+" "+n)}),o.$on("root:say",function(o,n){e.info(o.name+" "+n)})}]);
angular.module("doog.library-www").controller("LoginController",["$scope","$location","$log",function(o,n,i){i.info("location.url: "+n.url()),i.info("location.path: "+n.path()),i.info("location.absUrl: "+n.absUrl()),o.title="Login",o.$on("doog.say",function(){i.info("我听到 haha了。login.$scope")}),o.$on("doge.say",function(o,n){i.info(o.name+" "+n)}),o.$on("root:say",function(o,n){i.info(o.name+" "+n)})}]);
angular.module("doog.library-www").controller("NotFoundController",["$scope","$log",function(o,n){o.title="NotFound",o.$on("doog.say",function(){n.info("我听到 haha了。not_found.$scope")}),o.$on("doge.say",function(o,t){n.info(o.name+" "+t)}),o.$on("root:say",function(o,t){n.info(o.name+" "+t)})}]);
angular.module("doog.library-www").directive("myAccess",["authService","removeElement",function(e,r){return{restrict:"A",link:function(n,o,t){var c=!1,a=t.myAccess.split(" ");for(i=0;i<a.length;i++)if(e.userHasRole(a[i])){c=!0;break}c||(angular.forEach(o.children(),function(e){r(e)}),r(o))}}}]).constant("removeElement",function(e){e&&e.remove&&e.remove()});
angular.module("doog.library-www").service("AuthService",["$http",function(e){this.userLoggedIn=function(){return!0}}]);
angular.module("doog.library-www").factory("BookService",["$resource",function(r){return r("/app/data/books.json",{id:"@Id"},{express:{url:"/app/data/books-express.json",isArray:!0,params:{q:"宫崎骏"}},popular:{url:"/app/data/books-express.json",isArray:!0,params:{q:"宫崎骏"}}})}]);
angular.module("doog.library-www").factory("UserService",["$resource",function(r){return r("http://localhost:3000/users/:id",{id:"@Id"})}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImNvbnRyb2xsZXIvaGVscC5qcyIsImNvbnRyb2xsZXIvaG9tZS5qcyIsImNvbnRyb2xsZXIvbG9naW4uanMiLCJjb250cm9sbGVyL25vdF9mb3VuZC5qcyIsImRpcmVjdGl2ZS9teV9hY2Nlc3MuanMiLCJzZXJ2aWNlL2F1dGguanMiLCJzZXJ2aWNlL2Jvb2suanMiLCJzZXJ2aWNlL3VzZXIuanMiXSwibmFtZXMiOlsiYW5ndWxhciIsIm1vZHVsZSIsImNvbnN0YW50IiwiZmFjdG9yeSIsIiRxIiwiJGxvY2F0aW9uIiwiJGxvZyIsImludGVyY2VwdG9yIiwicmVxdWVzdCIsImNvbmZpZyIsImhlYWRlcnMiLCJhYnNVcmwiLCJyZXNwb25zZSIsInJlcXVlc3RFcnJvciIsInJlamVjdGlvbiIsInJlc3BvbnNlRXJyb3IiLCIkcm9vdFNjb3BlIiwiJGNvb2tpZXMiLCIkd2luZG93IiwiJHRpbWVvdXQiLCJMT0dJTl9VUkwiLCJpbmZvIiwiZ2V0Iiwic3RhdHVzIiwibG9jYXRpb24iLCJlbmNvZGVVUklDb21wb25lbnQiLCJocmVmIiwiaXNVbmRlZmluZWQiLCJkYXRhIiwiZXJyb3JzIiwidGV4dCIsImVycm9yS2V5Iiwic2hvd0Vycm9yTXNnIiwicmVqZWN0IiwiJGh0dHAiLCJ1c2VyUm9sZSIsInVzZXJSb2xlUm91dGVNYXAiLCJST0xFX0FETUlOIiwiUk9MRV9VU0VSIiwidXNlckxvZ2dlZEluIiwidXNlckhhc1JvbGUiLCJyb2xlIiwiaiIsImxlbmd0aCIsImlzVXJsQWNjZXNzaWJsZUZvclVzZXIiLCJyb3V0ZSIsImkiLCJ2YWxpZFVybHNGb3JSb2xlIiwiJGh0dHBQcm92aWRlciIsImRlZmF1bHRzIiwiY29tbW9uIiwiaW50ZXJjZXB0b3JzIiwicHVzaCIsIiRyb3V0ZVByb3ZpZGVyIiwiJGxvY2F0aW9uUHJvdmlkZXIiLCJ3aGVuIiwidGVtcGxhdGVVcmwiLCJjb250cm9sbGVyIiwib3RoZXJ3aXNlIiwicmVkaXJlY3RUbyIsInJ1biIsIiRpbnRlcnZhbCIsIkF1dGhTZXJ2aWNlIiwiTlByb2dyZXNzVGltZXIiLCIkb24iLCJOUHJvZ3Jlc3MiLCJyZW1vdmUiLCJzdGFydCIsImNhbmNlbCIsImluYyIsImRvbmUiLCJldnQiLCJuZXh0IiwiY3VycmVudCIsIiRlbWl0IiwicGF0aCIsInByZXZpb3VzIiwiZXJyb3IiLCJuYW1lIiwiJGJyb2FkY2FzdCIsIiRzY29wZSIsIkJvb2tTZXJ2aWNlIiwidGl0bGUiLCJzZWFyY2giLCJEYXRlIiwiZ2V0VGltZSIsInNpemUiLCJsb2FkIiwiZXhwcmVzcyIsImJvb2tMaXN0IiwiVXNlclNlcnZpY2UiLCJleHByZXNzQm9va3MiLCJwb3B1bGFyQm9va3MiLCJpZCIsInVzZXIiLCJwb3B1bGFyIiwiY29uc29sZSIsImxvZyIsInNheSIsInVybCIsImRpcmVjdGl2ZSIsImF1dGhTZXJ2aWNlIiwicmVtb3ZlRWxlbWVudCIsInJlc3RyaWN0IiwibGluayIsInNjb3BlIiwiZWxlbWVudCIsImF0dHJpYnV0ZXMiLCJoYXNBY2Nlc3MiLCJhbGxvd2VkQWNjZXNzIiwibXlBY2Nlc3MiLCJzcGxpdCIsImZvckVhY2giLCJjaGlsZHJlbiIsImNoaWxkIiwic2VydmljZSIsInRoaXMiLCIkcmVzb3VyY2UiLCJpc0FycmF5IiwicGFyYW1zIiwicSJdLCJtYXBwaW5ncyI6IkFBQ0FBLFFBQVFDLE9BQU8sb0JBQXFCLFVBQVcsYUFBYyxZQUFhLGtCQUNyRUMsU0FBUyxZQUFhLDJDQUN0QkMsUUFBUSxtQkFBb0IsS0FBTSxZQUFhLE9BQVEsU0FBU0MsRUFBSUMsRUFBV0MsR0FDNUUsR0FBSUMsSUFDQUMsUUFBVyxTQUFTQyxHQUdoQixNQUZBQSxHQUFPQyxRQUFrQixTQUFJTCxFQUFVTSxTQUVoQ0YsR0FFWEcsU0FBWSxTQUFTQSxHQUVqQixNQUFPQSxJQUVYQyxhQUFnQixTQUFTQyxHQUVyQixNQUFPQSxJQUlYQyxjQUFpQixTQUFTRCxHQUV0QixNQUFPQSxJQUtmLE9BQU9QLE1BRVZKLFFBQVEsbUJBQW9CLGFBQWMs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QVMsRUFDVEMsUUFDSUMsRUFBRztBQ2pCbkJ4SCxRQUFRQyxPQUFPLG9CQUFvQkUsUUFBUSxlQUFnQixZQUFhLFNBQVNrSCxHQUM3RSxNQUFPQSxHQUFVLG1DQUNieEIsR0FBSSIsImZpbGUiOiJhcHAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiO1xyXG5hbmd1bGFyLm1vZHVsZSgnZG9vZy5saWJyYXJ5LXd3dycsIFsnbmdSb3V0ZScsICduZ1Jlc291cmNlJywgJ25nQ29va2llcycsICdhbmd1bGFyLWNhY2hlJ10pXHJcbiAgICAuY29uc3RhbnQoJ0xPR0lOX1VSTCcsICdodHRwOi8vYWNjb3VudHMudHlraG9tZS5jb206MzAwMC9sb2dpbi8nKVxyXG4gICAgLmZhY3RvcnkoJ0h0dHBJbnRlcmNlcHRvcicsIFsnJHEnLCAnJGxvY2F0aW9uJywgJyRsb2cnLCBmdW5jdGlvbigkcSwgJGxvY2F0aW9uLCAkbG9nKSB7XHJcbiAgICAgICAgdmFyIGludGVyY2VwdG9yID0ge1xyXG4gICAgICAgICAgICAncmVxdWVzdCc6IGZ1bmN0aW9uKGNvbmZpZykge1xyXG4gICAgICAgICAgICAgICAgY29uZmlnLmhlYWRlcnNbXCJsb2NhdGlvblwiXSA9ICRsb2NhdGlvbi5hYnNVcmwoKTtcclxuICAgICAgICAgICAgICAgIC8vIOaIkOWKn+eahOivt+axguaWueazlVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpZzsgLy8g5oiW6ICFICRxLndoZW4oY29uZmlnKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgJ3Jlc3BvbnNlJzogZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIC8vIOWTjeW6lOaIkOWKn1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlOyAvLyDmiJbogIUgJHEud2hlbihjb25maWcpO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAncmVxdWVzdEVycm9yJzogZnVuY3Rpb24ocmVqZWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAvLyDor7fmsYLlj5HnlJ/kuobplJnor6/vvIzlpoLmnpzog73ku47plJnor6/kuK3mgaLlpI3vvIzlj6/ku6Xov5Tlm57kuIDkuKrmlrDnmoTor7fmsYLmiJZwcm9taXNlXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVqZWN0aW9uOyAvLyDmiJbmlrDnmoRwcm9taXNlXHJcbiAgICAgICAgICAgICAgICAvLyDmiJbogIXvvIzlj6/ku6XpgJrov4fov5Tlm57kuIDkuKpyZWplY3Rpb27mnaXpmLvmraLkuIvkuIDmraVcclxuICAgICAgICAgICAgICAgIC8vIHJldHVybiAkcS5yZWplY3QocmVqZWN0aW9uKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgJ3Jlc3BvbnNlRXJyb3InOiBmdW5jdGlvbihyZWplY3Rpb24pIHtcclxuICAgICAgICAgICAgICAgIC8vIOivt+axguWPkeeUn+S6humUmeivr++8jOWmguaenOiDveS7jumUmeivr+S4reaBouWkje+8jOWPr+S7pei/lOWbnuS4gOS4quaWsOeahOWTjeW6lOaIlnByb21pc2VcclxuICAgICAgICAgICAgICAgIHJldHVybiByZWplY3Rpb247IC8vIOaIluaWsOeahHByb21pc2VcclxuICAgICAgICAgICAgICAgIC8vIOaIluiAhe+8jOWPr+S7pemAmui/h+i/lOWbnuS4gOS4qnJlamVjdGlvbuadpemYu+atouS4i+S4gOatpVxyXG4gICAgICAgICAgICAgICAgLy8gcmV0dXJuICRxLnJlamVjdChyZWplY3Rpb24pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICByZXR1cm4gaW50ZXJjZXB0b3I7XHJcbiAgICB9XSlcclxuICAgIC5mYWN0b3J5KCdBdXRoSW50ZXJjZXB0b3InLCBbJyRyb290U2NvcGUnLCAnJHEnLCAnJGNvb2tpZXMnLCAnJGxvY2F0aW9uJywgJyR3aW5kb3cnLCAnJHRpbWVvdXQnLCAnJGxvZycsICdMT0dJTl9VUkwnLCBmdW5jdGlvbigkcm9vdFNjb3BlLCAkcSwgJGNvb2tpZXMsICRsb2NhdGlvbiwgJHdpbmRvdywgJHRpbWVvdXQsICRsb2csIExPR0lOX1VSTCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlcXVlc3Q6IGZ1bmN0aW9uKGNvbmZpZykge1xyXG4gICAgICAgICAgICAgICAgLy8gZGVsZXRlICRyb290U2NvcGUuZXJyb3JLZXk7XHJcbiAgICAgICAgICAgICAgICBjb25maWcuaGVhZGVyc1tcImxvY2F0aW9uXCJdID0gJGxvY2F0aW9uLmFic1VybCgpO1xyXG4gICAgICAgICAgICAgICAgY29uZmlnLmhlYWRlcnMgPSBjb25maWcuaGVhZGVycyB8fCB7fTtcclxuICAgICAgICAgICAgICAgICRsb2cuaW5mbygnWC1BVVRILVRPS0VOJywgJGNvb2tpZXMuZ2V0KCdYLUFVVEgtVE9LRU4nKSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoJGNvb2tpZXMuZ2V0KCdYLUFVVEgtVE9LRU4nKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZy5oZWFkZXJzWydYLUFVVEgtVE9LRU4nXSA9ICRjb29raWVzLmdldCgnWC1BVVRILVRPS0VOJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gY29uZmlnLmhlYWRlcnNbJ1gtQVVUSC1FTUFJTCddID0gJGNvb2tpZXMuZW1haWw7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gY29uZmlnO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICByZXNwb25zZUVycm9yOiBmdW5jdGlvbihyZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIHN0YXR1cyA9IHJlc3BvbnNlLnN0YXR1cztcclxuXHJcbiAgICAgICAgICAgICAgICAvLyB1c2VyIGlzIG5vdCBhdXRoZW50aWNhdGVkIC0+IHJlZGlyZWN0XHJcbiAgICAgICAgICAgICAgICBpZiAoc3RhdHVzID09PSA0MDEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbG9jYXRpb24gPSByZXNwb25zZS5oZWFkZXJzKCdsb2NhdGlvbicpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBpZiAobG9jYXRpb24pIGxvY2F0aW9uID0gZW5jb2RlVVJJKGxvY2F0aW9uKTsgLy8gd2FybjogZW5jb2RlVVJJKG51bGwpID09PSAnbnVsbCdcclxuICAgICAgICAgICAgICAgICAgICBpZiAobG9jYXRpb24pIGxvY2F0aW9uID0gZW5jb2RlVVJJQ29tcG9uZW50KGxvY2F0aW9uKTsgLy8gd2FybjogZW5jb2RlVVJJKG51bGwpID09PSAnbnVsbCdcclxuICAgICAgICAgICAgICAgICAgICAkd2luZG93LmxvY2F0aW9uLmhyZWYgPSBMT0dJTl9VUkwgKyAoISFsb2NhdGlvbiA/ICc/cmVkaXJlY3RVUkw9JyArIGxvY2F0aW9uIDogJycpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGlnbm9yZSBmb3JtIHZhbGlkYXRpb24gZXJyb3JzIGJlY2F1c2UgdGhlcmUgYXJlIGhhbmRsZWQgaW4gdGhlIHNwZWNpZmljIGNvbnRyb2xsZXJcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoc3RhdHVzICE9PSAwICYmIGFuZ3VsYXIuaXNVbmRlZmluZWQocmVzcG9uc2UuZGF0YS5lcnJvcnMpKSB7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIC8vIHNlcnZlciBlcnJvclxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5kYXRhLnRleHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS5lcnJvcktleSA9IHJlc3BvbnNlLmRhdGEudGV4dDtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLnNob3dFcnJvck1zZyA9IHRydWU7IC8vIGdlbmVyYWwgZXJyb3IgbWVzc2FnZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuc2hvd0Vycm9yTXNnID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sIDUwMDApO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gJHEucmVqZWN0KHJlc3BvbnNlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSlcclxuICAgIC5mYWN0b3J5KCdhdXRoU2VydmljZScsIFsnJGh0dHAnLCBmdW5jdGlvbigkaHR0cCkge1xyXG4gICAgICAgIHZhciB1c2VyUm9sZSA9IFtdOyAvLyBvYnRhaW5lZCBmcm9tIGJhY2tlbmRcclxuICAgICAgICB2YXIgdXNlclJvbGVSb3V0ZU1hcCA9IHtcclxuICAgICAgICAgICAgJ1JPTEVfQURNSU4nOiBbJy9kYXNoYm9hcmQnLCAnL2Fib3V0LXVzJywgJy9hdXRoRXJyb3InXSxcclxuICAgICAgICAgICAgJ1JPTEVfVVNFUic6IFsnL3VzZXJzZXR0aW5ncycsICcvdXNlcnNldHRpbmdzL3BlcnNvbmFsJywgJy9hdXRoRXJyb3InXVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHVzZXJMb2dnZWRJbjogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdXNlckhhc1JvbGU6IGZ1bmN0aW9uKHJvbGUpIHtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgdXNlclJvbGUubGVuZ3RoOyBqKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocm9sZSA9PSB1c2VyUm9sZVtqXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGlzVXJsQWNjZXNzaWJsZUZvclVzZXI6IGZ1bmN0aW9uKHJvdXRlKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHVzZXJSb2xlLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJvbGUgPSB1c2VyUm9sZVtpXTtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgdmFsaWRVcmxzRm9yUm9sZSA9IHVzZXJSb2xlUm91dGVNYXBbcm9sZV07XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbGlkVXJsc0ZvclJvbGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCB2YWxpZFVybHNGb3JSb2xlLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsaWRVcmxzRm9yUm9sZVtqXSA9PSByb3V0ZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9XSlcclxuICAgIC8vIC5jb25maWcoZnVuY3Rpb24oQ2FjaGVGYWN0b3J5UHJvdmlkZXIsICR3aW5kb3cpIHtcclxuICAgIC8vICAgICBhbmd1bGFyLmV4dGVuZChDYWNoZUZhY3RvcnlQcm92aWRlci5kZWZhdWx0cywge1xyXG4gICAgLy8gICAgICAgICBtYXhBZ2U6IDE1ICogNjAgKiAxMDAwLFxyXG4gICAgLy8gICAgICAgICBkZWxldGVPbkV4cGlyZTogJ3Bhc3NpdmUnLFxyXG4gICAgLy8gICAgICAgICBzdG9yYWdlTW9kZTogJ2xvY2FsU3RvcmFnZScsXHJcbiAgICAvLyAgICAgICAgIHN0b3JhZ2VJbXBsOiAkd2luZG93LmxvY2FsU3RvcmFnZVxyXG4gICAgLy8gICAgIH0pO1xyXG4gICAgLy8gfSlcclxuICAgIC8vIC5jb25maWcoWyckY29va2llc1Byb3ZpZGVyJywgZnVuY3Rpb24oJGNvb2tpZXNQcm92aWRlcikge1xyXG4gICAgLy8gICAgIC8vICRodHRwLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uW1wiWC1BVVRILVRPS0VOXCJdID0gJGNvb2tpZXNbJ0FVVEgtVE9LRU4nXTtcclxuICAgIC8vIH1dKVxyXG4gICAgLmNvbmZpZyhbJyRodHRwUHJvdmlkZXInLCBmdW5jdGlvbigkaHR0cFByb3ZpZGVyKSB7XHJcbiAgICAgICAgJGh0dHBQcm92aWRlci5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vblsneC1SZXF1ZXN0ZWQtV2l0aCddID0gJ1hNTEh0dHBSZXF1ZXN0JztcclxuICAgICAgICAkaHR0cFByb3ZpZGVyLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uWydYLVJlcXVlc3RlZC1CeSddID0gJ0FuZ3VsYXJBcHAnO1xyXG4gICAgICAgIC8vICRodHRwUHJvdmlkZXIuaW50ZXJjZXB0b3JzLnB1c2goJ0h0dHBJbnRlcmNlcHRvcicpO1xyXG4gICAgICAgICRodHRwUHJvdmlkZXIuaW50ZXJjZXB0b3JzLnB1c2goJ0F1dGhJbnRlcmNlcHRvcicpO1xyXG4gICAgfV0pXHJcbiAgICAuY29uZmlnKFsnJHJvdXRlUHJvdmlkZXInLCAnJGxvY2F0aW9uUHJvdmlkZXInLCBmdW5jdGlvbigkcm91dGVQcm92aWRlciwgJGxvY2F0aW9uUHJvdmlkZXIpIHtcclxuICAgICAgICAvLyBodG1sNei3r+eUseaooeW8j1xyXG4gICAgICAgIC8vICRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZSh0cnVlKS5oYXNoUHJlZml4KCchJyk7XHJcbiAgICAgICAgJHJvdXRlUHJvdmlkZXIud2hlbignLycsIHtcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYXBwL3ZpZXdzL2hvbWUuaHRtbCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdIb21lQ29udHJvbGxlcidcclxuICAgICAgICB9KS53aGVuKCcvbG9naW4nLCB7XHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2FwcC92aWV3cy9sb2dpbi5odG1sJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ0xvZ2luQ29udHJvbGxlcidcclxuICAgICAgICB9KS53aGVuKCcvaGVscCcsIHtcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYXBwL3ZpZXdzL2hlbHAuaHRtbCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdIZWxwQ29udHJvbGxlcidcclxuICAgICAgICB9KS53aGVuKCcvNDA0Jywge1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9hcHAvdmlld3MvNDA0Lmh0bWwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnTm90Rm91bmRDb250cm9sbGVyJ1xyXG4gICAgICAgIH0pLm90aGVyd2lzZSh7XHJcbiAgICAgICAgICAgIHJlZGlyZWN0VG86ICcvNDA0J1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIH1dKVxyXG4gICAgLy8gLmNvbmZpZyhbJyRodHRwUHJvdmlkZXInLCAnJGNhY2hlRmFjdG9yeScsIGZ1bmN0aW9uKCRodHRwUHJvdmlkZXIsICRjYWNoZUZhY3RvcnkpIHtcclxuICAgIC8vICAgICAkaHR0cFByb3ZpZGVyLmRlZmF1bHRzLmNhY2hlID0gJGNhY2hlRmFjdG9yeSgnbHJ1Jywge1xyXG4gICAgLy8gICAgICAgICBjYXBhY2l0eTogMTAwXHJcbiAgICAvLyAgICAgfSk7XHJcbiAgICAvLyB9XSlcclxuICAgIC5ydW4oWyckcm9vdFNjb3BlJywgJyRsb2NhdGlvbicsICckbG9nJywgJyRpbnRlcnZhbCcsICdBdXRoU2VydmljZScsIGZ1bmN0aW9uKCRyb290U2NvcGUsICRsb2NhdGlvbiwgJGxvZywgJGludGVydmFsLCBBdXRoU2VydmljZSkge1xyXG4gICAgICAgIHZhciBOUHJvZ3Jlc3NUaW1lcjtcclxuICAgICAgICAkcm9vdFNjb3BlLiRvbigncGFnZTpmZXRjaCcsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBOUHJvZ3Jlc3MucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgIE5Qcm9ncmVzcy5zdGFydCgpO1xyXG5cclxuICAgICAgICAgICAgJGludGVydmFsLmNhbmNlbChOUHJvZ3Jlc3NUaW1lcik7XHJcbiAgICAgICAgICAgIE5Qcm9ncmVzc1RpbWVyID0gJGludGVydmFsKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgTlByb2dyZXNzLmluYygpO1xyXG4gICAgICAgICAgICB9LCA1MDApO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAkcm9vdFNjb3BlLiRvbigncGFnZTpjaGFuZ2UnLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgJGludGVydmFsLmNhbmNlbChOUHJvZ3Jlc3NUaW1lcik7XHJcbiAgICAgICAgICAgIE5Qcm9ncmVzcy5kb25lKCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIHJvdXRlIGV2ZW50XHJcbiAgICAgICAgJHJvb3RTY29wZS4kb24oJyRyb3V0ZUNoYW5nZVN0YXJ0JywgZnVuY3Rpb24oZXZ0LCBuZXh0LCBjdXJyZW50KSB7XHJcbiAgICAgICAgICAgICRyb290U2NvcGUuJGVtaXQoJ3BhZ2U6ZmV0Y2gnKTtcclxuXHJcbiAgICAgICAgICAgIC8vIGlmICghYXV0aFNlcnZpY2UuaXNVcmxBY2Nlc3NpYmxlRm9yVXNlcihuZXh0Lm9yaWdpbmFsUGF0aCkpXHJcbiAgICAgICAgICAgIC8vICAgICAkbG9jYXRpb24ucGF0aCgnL2F1dGhFcnJvcicpO1xyXG5cclxuICAgICAgICAgICAgJGxvZy5pbmZvKCckcm91dGVDaGFuZ2VTdGFydCcpO1xyXG4gICAgICAgICAgICAvLyDlpoLmnpznlKjmiLfmnKrnmbvlvZVcclxuICAgICAgICAgICAgaWYgKCFBdXRoU2VydmljZS51c2VyTG9nZ2VkSW4oKSkge1xyXG4gICAgICAgICAgICAgICAgaWYgKG5leHQudGVtcGxhdGVVcmwgPT09IFwibG9naW4uaHRtbFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8g5bey57uP6L2s5ZCR55m75b2V6Lev55Sx5Zug5q2k5peg6ZyA6YeN5a6a5ZCRXHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvbG9naW4nKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAkcm9vdFNjb3BlLiRvbignJHJvdXRlQ2hhbmdlU3VjY2VzcycsIGZ1bmN0aW9uKGV2dCwgbmV4dCwgcHJldmlvdXMpIHtcclxuICAgICAgICAgICAgJHJvb3RTY29wZS4kZW1pdCgncGFnZTpjaGFuZ2UnKTtcclxuICAgICAgICAgICAgJGxvZy5pbmZvKCckcm91dGVDaGFuZ2VTdWNjZXNzJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICRyb290U2NvcGUuJG9uKCckcm91dGVDaGFuZ2VFcnJvcicsIGZ1bmN0aW9uKGN1cnJlbnQsIHByZXZpb3VzLCByZWplY3Rpb24sIGVycm9yKSB7XHJcbiAgICAgICAgICAgICRyb290U2NvcGUuJGVtaXQoJ3BhZ2U6Y2hhbmdlJyk7XHJcbiAgICAgICAgICAgICRsb2cuZXJyb3IocHJldmlvdXMudGVtcGxhdGVVcmwpO1xyXG4gICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL2hvbWUnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgJHJvb3RTY29wZS4kb24oJ2Rvb2cuc2F5JywgZnVuY3Rpb24oZXZ0LCBkYXRhKSB7XHJcbiAgICAgICAgICAgICRsb2cuaW5mbyhldnQubmFtZSArICcgJyArIGRhdGEpO1xyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2RvZ2Uuc2F5JywgJ0dPJyk7XHJcbiAgICAgICAgICAgICRyb290U2NvcGUuJGVtaXQoJ3Jvb3Q6c2F5Jyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XSk7XHJcbiIsIjtcbmFuZ3VsYXIubW9kdWxlKCdkb29nLmxpYnJhcnktd3d3JykuY29udHJvbGxlcignSGVscENvbnRyb2xsZXInLCBbJyRzY29wZScsICckbG9nJywgJyRsb2NhdGlvbicsICdCb29rU2VydmljZScsIGZ1bmN0aW9uKCRzY29wZSwgJGxvZywgJGxvY2F0aW9uLCBCb29rU2VydmljZSkge1xuICAgICRzY29wZS50aXRsZSA9ICdIZWxwJztcblxuICAgICRzY29wZS4kb24oJ2Rvb2cuc2F5JywgZnVuY3Rpb24oKSB7XG4gICAgICAgICRsb2cuaW5mbygn5oiR5ZCs5YiwIGhhaGHkuobjgIJoZWxwLiRzY29wZScpO1xuICAgIH0pXG5cbiAgICAkc2NvcGUuJG9uKCdkb2dlLnNheScsIGZ1bmN0aW9uKGV2dCwgZGF0YSkge1xuICAgICAgICAkbG9nLmluZm8oZXZ0Lm5hbWUgKyAnICcgKyBkYXRhKTtcbiAgICB9KTtcblxuICAgICRzY29wZS4kb24oJ3Jvb3Q6c2F5JywgZnVuY3Rpb24oZXZ0LCBkYXRhKSB7XG4gICAgICAgICRsb2cuaW5mbyhldnQubmFtZSArICcgJyArIGRhdGEpO1xuICAgIH0pO1xuXG4gICAgJHNjb3BlLm5leHQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgJGxvY2F0aW9uLnNlYXJjaCh7XG4gICAgICAgICAgICBzdGFydDogbmV3IERhdGUoKS5nZXRUaW1lKCksXG4gICAgICAgICAgICBzaXplOiAxMFxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAkc2NvcGUubG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBCb29rU2VydmljZS5leHByZXNzKGZ1bmN0aW9uKGJvb2tMaXN0KSB7XG4gICAgICAgICAgICAkbG9nLmluZm8oYm9va0xpc3QubGVuZ3RoKTtcbiAgICAgICAgfSk7XG4gICAgfVxufV0pO1xuIiwiO1xuYW5ndWxhci5tb2R1bGUoJ2Rvb2cubGlicmFyeS13d3cnKS5jb250cm9sbGVyKCdIb21lQ29udHJvbGxlcicsIFsnJHNjb3BlJywgJyRsb2NhdGlvbicsICckbG9nJywgJ0Jvb2tTZXJ2aWNlJywgJ1VzZXJTZXJ2aWNlJywgZnVuY3Rpb24oJHNjb3BlLCAkbG9jYXRpb24sICRsb2csIEJvb2tTZXJ2aWNlLCBVc2VyU2VydmljZSkge1xuICAgICRzY29wZS50aXRsZSA9ICdIb21lJztcbiAgICAkc2NvcGUuZXhwcmVzc0Jvb2tzID0gW107XG4gICAgJHNjb3BlLnBvcHVsYXJCb29rcyA9IFtdO1xuXG4gICAgVXNlclNlcnZpY2UuZ2V0KHtpZDogJzc3ODgnfSwgZnVuY3Rpb24gKHVzZXIpIHtcbiAgICAgICAgJHNjb3BlLnVzZXIgPSB1c2VyO1xuICAgIH0pO1xuXG4gICAgQm9va1NlcnZpY2UuZXhwcmVzcyhmdW5jdGlvbihib29rTGlzdCkge1xuICAgICAgICAkc2NvcGUuZXhwcmVzc0Jvb2tzID0gYm9va0xpc3Q7XG4gICAgfSk7XG5cbiAgICBCb29rU2VydmljZS5wb3B1bGFyKGZ1bmN0aW9uKGJvb2tMaXN0KSB7XG4gICAgICAgICRzY29wZS5wb3B1bGFyQm9va3MgPSBib29rTGlzdDtcbiAgICB9KTtcblxuXG4gICAgJHNjb3BlLmxvYWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgQm9va1NlcnZpY2UuZXhwcmVzcyhmdW5jdGlvbihib29rTGlzdCkge1xuICAgICAgICAgICAgJGxvZy5pbmZvKGJvb2tMaXN0Lmxlbmd0aCk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIHJvdXRlIGV2ZW50XG4gICAgJHNjb3BlLiRvbignJHJvdXRlQ2hhbmdlU3RhcnQnLCBmdW5jdGlvbihldnQsIG5leHQsIGN1cnJlbnQpIHtcbiAgICAgICAgY29uc29sZS5sb2coJyRzY29wZSAkcm91dGVDaGFuZ2VTdGFydCcpO1xuICAgIH0pO1xuXG4gICAgJHNjb3BlLnNheSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAkc2NvcGUuJGVtaXQoJ2Rvb2cuc2F5JywgJ2hhaGF+Jyk7XG4gICAgfVxuXG4gICAgJHNjb3BlLiRvbignZG9vZy5zYXknLCBmdW5jdGlvbigpIHtcbiAgICAgICAgJGxvZy5pbmZvKCfmiJHlkKzliLAgaGFoYeS6huOAgmhvbWUuJHNjb3BlJyk7XG4gICAgfSk7XG5cbiAgICAkc2NvcGUuJG9uKCdkb2dlLnNheScsIGZ1bmN0aW9uKGV2dCwgZGF0YSkge1xuICAgICAgICAkbG9nLmluZm8oZXZ0Lm5hbWUgKyAnICcgKyBkYXRhKTtcbiAgICB9KTtcblxuICAgICRzY29wZS4kb24oJ3Jvb3Q6c2F5JywgZnVuY3Rpb24oZXZ0LCBkYXRhKSB7XG4gICAgICAgICRsb2cuaW5mbyhldnQubmFtZSArICcgJyArIGRhdGEpO1xuICAgIH0pO1xufV0pO1xuIiwiO1xuYW5ndWxhci5tb2R1bGUoJ2Rvb2cubGlicmFyeS13d3cnKS5jb250cm9sbGVyKCdMb2dpbkNvbnRyb2xsZXInLCBbJyRzY29wZScsICckbG9jYXRpb24nLCAnJGxvZycsIGZ1bmN0aW9uKCRzY29wZSwgJGxvY2F0aW9uLCAkbG9nKSB7XG4gICAgJGxvZy5pbmZvKCdsb2NhdGlvbi51cmw6ICcgKyAkbG9jYXRpb24udXJsKCkpO1xuICAgICRsb2cuaW5mbygnbG9jYXRpb24ucGF0aDogJyArICRsb2NhdGlvbi5wYXRoKCkpO1xuICAgICRsb2cuaW5mbygnbG9jYXRpb24uYWJzVXJsOiAnICsgJGxvY2F0aW9uLmFic1VybCgpKTtcbiAgICAkc2NvcGUudGl0bGUgPSAnTG9naW4nO1xuXG4gICAgJHNjb3BlLiRvbignZG9vZy5zYXknLCBmdW5jdGlvbigpIHtcbiAgICAgICAgJGxvZy5pbmZvKCfmiJHlkKzliLAgaGFoYeS6huOAgmxvZ2luLiRzY29wZScpO1xuICAgIH0pO1xuXG4gICAgJHNjb3BlLiRvbignZG9nZS5zYXknLCBmdW5jdGlvbihldnQsIGRhdGEpIHtcbiAgICAgICAgJGxvZy5pbmZvKGV2dC5uYW1lICsgJyAnICsgZGF0YSk7XG4gICAgfSk7XG5cbiAgICAkc2NvcGUuJG9uKCdyb290OnNheScsIGZ1bmN0aW9uKGV2dCwgZGF0YSkge1xuICAgICAgICAkbG9nLmluZm8oZXZ0Lm5hbWUgKyAnICcgKyBkYXRhKTtcbiAgICB9KTtcbn1dKTtcbiIsIjtcbmFuZ3VsYXIubW9kdWxlKCdkb29nLmxpYnJhcnktd3d3JykuY29udHJvbGxlcignTm90Rm91bmRDb250cm9sbGVyJywgWyckc2NvcGUnLCAnJGxvZycsIGZ1bmN0aW9uKCRzY29wZSwgJGxvZykge1xuICAgICRzY29wZS50aXRsZSA9ICdOb3RGb3VuZCc7XG5cbiAgICAkc2NvcGUuJG9uKCdkb29nLnNheScsIGZ1bmN0aW9uKCkge1xuICAgICAgICAkbG9nLmluZm8oJ+aIkeWQrOWIsCBoYWhh5LqG44CCbm90X2ZvdW5kLiRzY29wZScpO1xuICAgIH0pO1xuXG4gICAgJHNjb3BlLiRvbignZG9nZS5zYXknLCBmdW5jdGlvbihldnQsIGRhdGEpIHtcbiAgICAgICAgJGxvZy5pbmZvKGV2dC5uYW1lICsgJyAnICsgZGF0YSk7XG4gICAgfSk7XG5cbiAgICAkc2NvcGUuJG9uKCdyb290OnNheScsIGZ1bmN0aW9uKGV2dCwgZGF0YSkge1xuICAgICAgICAkbG9nLmluZm8oZXZ0Lm5hbWUgKyAnICcgKyBkYXRhKTtcbiAgICB9KTtcbn1dKTtcbiIsImFuZ3VsYXIubW9kdWxlKCdkb29nLmxpYnJhcnktd3d3JykuZGlyZWN0aXZlKCdteUFjY2VzcycsIFsnYXV0aFNlcnZpY2UnLCAncmVtb3ZlRWxlbWVudCcsIGZ1bmN0aW9uKGF1dGhTZXJ2aWNlLCByZW1vdmVFbGVtZW50KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgcmVzdHJpY3Q6ICdBJyxcbiAgICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHJpYnV0ZXMpIHtcbiAgICAgICAgICAgIHZhciBoYXNBY2Nlc3MgPSBmYWxzZTtcbiAgICAgICAgICAgIHZhciBhbGxvd2VkQWNjZXNzID0gYXR0cmlidXRlcy5teUFjY2Vzcy5zcGxpdChcIiBcIik7XG4gICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgYWxsb3dlZEFjY2Vzcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGlmIChhdXRoU2VydmljZS51c2VySGFzUm9sZShhbGxvd2VkQWNjZXNzW2ldKSkge1xuICAgICAgICAgICAgICAgICAgICBoYXNBY2Nlc3MgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghaGFzQWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKGVsZW1lbnQuY2hpbGRyZW4oKSwgZnVuY3Rpb24oY2hpbGQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlRWxlbWVudChjaGlsZCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmVtb3ZlRWxlbWVudChlbGVtZW50KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9XG4gICAgfVxufV0pLmNvbnN0YW50KCdyZW1vdmVFbGVtZW50JywgZnVuY3Rpb24oZWxlbWVudCkge1xuICAgIGVsZW1lbnQgJiYgZWxlbWVudC5yZW1vdmUgJiYgZWxlbWVudC5yZW1vdmUoKTtcbn0pO1xuIiwiO1xuYW5ndWxhci5tb2R1bGUoJ2Rvb2cubGlicmFyeS13d3cnKS5zZXJ2aWNlKCdBdXRoU2VydmljZScsIFsnJGh0dHAnLCBmdW5jdGlvbigkaHR0cCkge1xuICAgIHRoaXMudXNlckxvZ2dlZEluID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbn1dKTtcbiIsIjtcbmFuZ3VsYXIubW9kdWxlKCdkb29nLmxpYnJhcnktd3d3JykuZmFjdG9yeSgnQm9va1NlcnZpY2UnLCBbJyRyZXNvdXJjZScsIGZ1bmN0aW9uKCRyZXNvdXJjZSkge1xuICAgIHJldHVybiAkcmVzb3VyY2UoJy9hcHAvZGF0YS9ib29rcy5qc29uJywge1xuICAgICAgICBpZDogXCJASWRcIlxuICAgIH0sIHtcbiAgICAgICAgLy8g5paw5LmmXG4gICAgICAgIGV4cHJlc3M6IHtcbiAgICAgICAgICAgIHVybDogJy9hcHAvZGF0YS9ib29rcy1leHByZXNzLmpzb24nLFxuICAgICAgICAgICAgaXNBcnJheTogdHJ1ZSxcbiAgICAgICAgICAgIHBhcmFtczoge1xuICAgICAgICAgICAgICAgIHE6ICflrqvltI7pqo8nXG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIC8vIOeDreamnFxuICAgICAgICBwb3B1bGFyOiB7XG4gICAgICAgICAgICB1cmw6ICcvYXBwL2RhdGEvYm9va3MtZXhwcmVzcy5qc29uJyxcbiAgICAgICAgICAgIGlzQXJyYXk6IHRydWUsXG4gICAgICAgICAgICBwYXJhbXM6IHtcbiAgICAgICAgICAgICAgICBxOiAn5a6r5bSO6aqPJ1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG59XSk7XG4iLCI7XG5hbmd1bGFyLm1vZHVsZSgnZG9vZy5saWJyYXJ5LXd3dycpLmZhY3RvcnkoJ1VzZXJTZXJ2aWNlJywgWyckcmVzb3VyY2UnLCBmdW5jdGlvbigkcmVzb3VyY2UpIHtcbiAgICByZXR1cm4gJHJlc291cmNlKCdodHRwOi8vbG9jYWxob3N0OjMwMDAvdXNlcnMvOmlkJywge1xuICAgICAgICBpZDogXCJASWRcIlxuICAgIH0pO1xufV0pO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9