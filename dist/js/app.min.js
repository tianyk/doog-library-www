angular.module("doog.library-www",["ngRoute","ngResource","ngCookies"]).constant("LOGIN_URL","http://accounts.tykhome.com:3000/login/").factory("HttpInterceptor",["$q","$location","$log",function(e,r,o){var t={request:function(e){return e.headers.location=r.absUrl(),e},response:function(e){return e},requestError:function(e){return e},responseError:function(e){return e}};return t}]).factory("AuthInterceptor",["$rootScope","$q","$cookies","$location","$window","$timeout","$log","LOGIN_URL",function(e,r,o,t,n,a,i,u){return{request:function(e){return e.headers.location=t.absUrl(),e.headers=e.headers||{},i.info("X-AUTH-TOKEN",o.get("X-AUTH-TOKEN")),o.get("X-AUTH-TOKEN")&&(e.headers["X-AUTH-TOKEN"]=o.get("X-AUTH-TOKEN")),e},responseError:function(o){var t=o.status;if(401===t){var i=o.headers("location");i&&(i=encodeURIComponent(i)),n.location.href=u+(i?"?redirectURL="+i:"")}else 0!==t&&angular.isUndefined(o.data.errors)&&(o.data.text?e.errorKey=o.data.text:(e.showErrorMsg=!0,a(function(){e.showErrorMsg=!1},5e3)));return r.reject(o)}}}]).factory("authService",["$http",function(e){var r=[],o={ROLE_ADMIN:["/dashboard","/about-us","/authError"],ROLE_USER:["/usersettings","/usersettings/personal","/authError"]};return{userLoggedIn:function(){return!0},userHasRole:function(e){for(var o=0;o<r.length;o++)if(e==r[o])return!0;return!1},isUrlAccessibleForUser:function(e){for(var t=0;t<r.length;t++){var n=r[t],a=o[n];if(a)for(var i=0;i<a.length;i++)if(a[i]==e)return!0}return!1}}}]).config(["$httpProvider",function(e){e.defaults.headers.common["x-Requested-With"]="XMLHttpRequest",e.interceptors.push("AuthInterceptor")}]).config(["$routeProvider","$locationProvider",function(e,r){e.when("/",{templateUrl:"/app/views/home.html",controller:"HomeController"}).when("/login",{templateUrl:"/app/views/login.html",controller:"LoginController"}).when("/help",{templateUrl:"/app/views/help.html",controller:"HelpController"}).when("/not-found",{templateUrl:"/app/views/not_found.html",controller:"NotFoundController"}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$location","$log","$interval","AuthService",function(e,r,o,t,n){var a;e.$on("page:fetch",function(){NProgress.remove(),NProgress.start(),t.cancel(a),a=t(function(){NProgress.inc()},500)}),e.$on("page:change",function(){t.cancel(a),NProgress.done()}),e.$on("$routeChangeStart",function(t,a,i){e.$emit("page:fetch"),o.info("$routeChangeStart"),n.userLoggedIn()||"login.html"===a.templateUrl||r.path("/login")}),e.$on("$routeChangeSuccess",function(r,t,n){e.$emit("page:change"),o.info("$routeChangeSuccess")}),e.$on("$routeChangeError",function(t,n,a,i){e.$emit("page:change"),o.error(n.templateUrl),r.path("/home")}),e.$on("doog.say",function(r,t){o.info(r.name+" "+t),e.$broadcast("doge.say","GO"),e.$emit("root:say")})}]);
angular.module("doog.library-www").controller("HelpController",["$scope","$log","$location","BookService",function(o,n,e,t){o.title="Help",o.$on("doog.say",function(){n.info("我听到 haha了。help.$scope")}),o.$on("doge.say",function(o,e){n.info(o.name+" "+e)}),o.$on("root:say",function(o,e){n.info(o.name+" "+e)}),o.next=function(){e.search({start:(new Date).getTime(),size:10})},o.load=function(){t.express(function(o){n.info(o.length)})}}]);
angular.module("doog.library-www").controller("HomeController",["$scope","$location","$log","BookService","UserService",function(o,n,e,t,a){o.title="Home",o.expressBooks=[],o.popularBooks=[],a.get({id:"7788"},function(n){o.user=n}),t.express(function(n){o.expressBooks=n}),t.popular(function(n){o.popularBooks=n}),o.load=function(){t.express(function(o){e.info(o.length)})},o.$on("$routeChangeStart",function(o,n,e){console.log("$scope $routeChangeStart")}),o.say=function(){o.$emit("doog.say","haha~")},o.$on("doog.say",function(){e.info("我听到 haha了。home.$scope")}),o.$on("doge.say",function(o,n){e.info(o.name+" "+n)}),o.$on("root:say",function(o,n){e.info(o.name+" "+n)})}]);
angular.module("doog.library-www").controller("LoginController",["$scope","$location","$log",function(o,n,i){i.info("location.url: "+n.url()),i.info("location.path: "+n.path()),i.info("location.absUrl: "+n.absUrl()),o.title="Login",o.$on("doog.say",function(){i.info("我听到 haha了。login.$scope")}),o.$on("doge.say",function(o,n){i.info(o.name+" "+n)}),o.$on("root:say",function(o,n){i.info(o.name+" "+n)})}]);
angular.module("doog.library-www").controller("NotFoundController",["$scope","$log",function(o,n){o.title="NotFound",o.$on("doog.say",function(){n.info("我听到 haha了。not_found.$scope")}),o.$on("doge.say",function(o,t){n.info(o.name+" "+t)}),o.$on("root:say",function(o,t){n.info(o.name+" "+t)})}]);
angular.module("doog.library-www").directive("myAccess",["authService","removeElement",function(e,r){return{restrict:"A",link:function(n,o,t){var c=!1,a=t.myAccess.split(" ");for(i=0;i<a.length;i++)if(e.userHasRole(a[i])){c=!0;break}c||(angular.forEach(o.children(),function(e){r(e)}),r(o))}}}]).constant("removeElement",function(e){e&&e.remove&&e.remove()});
angular.module("doog.library-www").service("AuthService",["$http",function(e){this.userLoggedIn=function(){return!0}}]);
angular.module("doog.library-www").factory("BookService",["$resource",function(r){return r("/app/data/books.json",{id:"@Id"},{express:{url:"/app/data/books-express.json",isArray:!0,params:{q:"宫崎骏"}},popular:{url:"/app/data/books-express.json",isArray:!0,params:{q:"宫崎骏"}}})}]);
angular.module("doog.library-www").factory("UserService",["$resource",function(r){return r("http://localhost:3000/users/:id",{id:"@Id"})}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImNvbnRyb2xsZXIvaGVscC5qcyIsImNvbnRyb2xsZXIvaG9tZS5qcyIsImNvbnRyb2xsZXIvbG9naW4uanMiLCJjb250cm9sbGVyL25vdF9mb3VuZC5qcyIsImRpcmVjdGl2ZS9teV9hY2Nlc3MuanMiLCJzZXJ2aWNlL2F1dGguanMiLCJzZXJ2aWNlL2Jvb2suanMiLCJzZXJ2aWNlL3VzZXIuanMiXSwibmFtZXMiOlsiYW5ndWxhciIsIm1vZHVsZSIsImNvbnN0YW50IiwiZmFjdG9yeSIsIiRxIiwiJGxvY2F0aW9uIiwiJGxvZyIsImludGVyY2VwdG9yIiwicmVxdWVzdCIsImNvbmZpZyIsImhlYWRlcnMiLCJhYnNVcmwiLCJyZXNwb25zZSIsInJlcXVlc3RFcnJvciIsInJlamVjdGlvbiIsInJlc3BvbnNlRXJyb3IiLCIkcm9vdFNjb3BlIiwiJGNvb2tpZXMiLCIkd2luZG93IiwiJHRpbWVvdXQiLCJMT0dJTl9VUkwiLCJpbmZvIiwiZ2V0Iiwic3RhdHVzIiwibG9jYXRpb24iLCJlbmNvZGVVUklDb21wb25lbnQiLCJocmVmIiwiaXNVbmRlZmluZWQiLCJkYXRhIiwiZXJyb3JzIiwidGV4dCIsImVycm9yS2V5Iiwic2hvd0Vycm9yTXNnIiwicmVqZWN0IiwiJGh0dHAiLCJ1c2VyUm9sZSIsInVzZXJSb2xlUm91dGVNYXAiLCJST0xFX0FETUlOIiwiUk9MRV9VU0VSIiwidXNlckxvZ2dlZEluIiwidXNlckhhc1JvbGUiLCJyb2xlIiwiaiIsImxlbmd0aCIsImlzVXJsQWNjZXNzaWJsZUZvclVzZXIiLCJyb3V0ZSIsImkiLCJ2YWxpZFVybHNGb3JSb2xlIiwiJGh0dHBQcm92aWRlciIsImRlZmF1bHRzIiwiY29tbW9uIiwiaW50ZXJjZXB0b3JzIiwicHVzaCIsIiRyb3V0ZVByb3ZpZGVyIiwiJGxvY2F0aW9uUHJvdmlkZXIiLCJ3aGVuIiwidGVtcGxhdGVVcmwiLCJjb250cm9sbGVyIiwib3RoZXJ3aXNlIiwicmVkaXJlY3RUbyIsInJ1biIsIiRpbnRlcnZhbCIsIkF1dGhTZXJ2aWNlIiwiTlByb2dyZXNzVGltZXIiLCIkb24iLCJOUHJvZ3Jlc3MiLCJyZW1vdmUiLCJzdGFydCIsImNhbmNlbCIsImluYyIsImRvbmUiLCJldnQiLCJuZXh0IiwiY3VycmVudCIsIiRlbWl0IiwicGF0aCIsInByZXZpb3VzIiwiZXJyb3IiLCJuYW1lIiwiJGJyb2FkY2FzdCIsIiRzY29wZSIsIkJvb2tTZXJ2aWNlIiwidGl0bGUiLCJzZWFyY2giLCJEYXRlIiwiZ2V0VGltZSIsInNpemUiLCJsb2FkIiwiZXhwcmVzcyIsImJvb2tMaXN0IiwiVXNlclNlcnZpY2UiLCJleHByZXNzQm9va3MiLCJwb3B1bGFyQm9va3MiLCJpZCIsInVzZXIiLCJwb3B1bGFyIiwiY29uc29sZSIsImxvZyIsInNheSIsInVybCIsImRpcmVjdGl2ZSIsImF1dGhTZXJ2aWNlIiwicmVtb3ZlRWxlbWVudCIsInJlc3RyaWN0IiwibGluayIsInNjb3BlIiwiZWxlbWVudCIsImF0dHJpYnV0ZXMiLCJoYXNBY2Nlc3MiLCJhbGxvd2VkQWNjZXNzIiwibXlBY2Nlc3MiLCJzcGxpdCIsImZvckVhY2giLCJjaGlsZHJlbiIsImNoaWxkIiwic2VydmljZSIsInRoaXMiLCIkcmVzb3VyY2UiLCJpc0FycmF5IiwicGFyYW1zIiwicSJdLCJtYXBwaW5ncyI6IkFBQ0FBLFFBQVFDLE9BQU8sb0JBQXFCLFVBQVcsYUFBYyxjQUN4REMsU0FBUyxZQUFhLDJDQUN0QkMsUUFBUSxtQkFBb0IsS0FBTSxZQUFhLE9BQVEsU0FBU0MsRUFBSUMsRUFBV0MsR0FDNUUsR0FBSUMsSUFDQUMsUUFBVyxTQUFTQyxHQUdoQixNQUZBQSxHQUFPQyxRQUFrQixTQUFJTCxFQUFVTSxTQUVoQ0YsR0FFWEcsU0FBWSxTQUFTQSxHQUVqQixNQUFPQSxJQUVYQyxhQUFnQixTQUFTQyxHQUVyQixNQUFPQSxJQUlYQyxjQUFpQixTQUFTRCxHQUV0QixNQUFPQSxJQUtmLE9BQU9QLE1BRVZKLFFBQVEsbUJBQW9CLGFBQWMsS0FBTSxX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QkUsUUFBUSxlQUFnQixZQUFhLFNBQVNrSCxHQUM3RSxNQUFPQSxHQUFVLG1DQUNieEIsR0FBSSIsImZpbGUiOiJhcHAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiO1xyXG5hbmd1bGFyLm1vZHVsZSgnZG9vZy5saWJyYXJ5LXd3dycsIFsnbmdSb3V0ZScsICduZ1Jlc291cmNlJywgJ25nQ29va2llcyddKVxyXG4gICAgLmNvbnN0YW50KCdMT0dJTl9VUkwnLCAnaHR0cDovL2FjY291bnRzLnR5a2hvbWUuY29tOjMwMDAvbG9naW4vJylcclxuICAgIC5mYWN0b3J5KCdIdHRwSW50ZXJjZXB0b3InLCBbJyRxJywgJyRsb2NhdGlvbicsICckbG9nJywgZnVuY3Rpb24oJHEsICRsb2NhdGlvbiwgJGxvZykge1xyXG4gICAgICAgIHZhciBpbnRlcmNlcHRvciA9IHtcclxuICAgICAgICAgICAgJ3JlcXVlc3QnOiBmdW5jdGlvbihjb25maWcpIHtcclxuICAgICAgICAgICAgICAgIGNvbmZpZy5oZWFkZXJzW1wibG9jYXRpb25cIl0gPSAkbG9jYXRpb24uYWJzVXJsKCk7XHJcbiAgICAgICAgICAgICAgICAvLyDmiJDlip/nmoTor7fmsYLmlrnms5VcclxuICAgICAgICAgICAgICAgIHJldHVybiBjb25maWc7IC8vIOaIluiAhSAkcS53aGVuKGNvbmZpZyk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICdyZXNwb25zZSc6IGZ1bmN0aW9uKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAvLyDlk43lupTmiJDlip9cclxuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZTsgLy8g5oiW6ICFICRxLndoZW4oY29uZmlnKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgJ3JlcXVlc3RFcnJvcic6IGZ1bmN0aW9uKHJlamVjdGlvbikge1xyXG4gICAgICAgICAgICAgICAgLy8g6K+35rGC5Y+R55Sf5LqG6ZSZ6K+v77yM5aaC5p6c6IO95LuO6ZSZ6K+v5Lit5oGi5aSN77yM5Y+v5Lul6L+U5Zue5LiA5Liq5paw55qE6K+35rGC5oiWcHJvbWlzZVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlamVjdGlvbjsgLy8g5oiW5paw55qEcHJvbWlzZVxyXG4gICAgICAgICAgICAgICAgLy8g5oiW6ICF77yM5Y+v5Lul6YCa6L+H6L+U5Zue5LiA5LiqcmVqZWN0aW9u5p2l6Zi75q2i5LiL5LiA5q2lXHJcbiAgICAgICAgICAgICAgICAvLyByZXR1cm4gJHEucmVqZWN0KHJlamVjdGlvbik7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICdyZXNwb25zZUVycm9yJzogZnVuY3Rpb24ocmVqZWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICAvLyDor7fmsYLlj5HnlJ/kuobplJnor6/vvIzlpoLmnpzog73ku47plJnor6/kuK3mgaLlpI3vvIzlj6/ku6Xov5Tlm57kuIDkuKrmlrDnmoTlk43lupTmiJZwcm9taXNlXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVqZWN0aW9uOyAvLyDmiJbmlrDnmoRwcm9taXNlXHJcbiAgICAgICAgICAgICAgICAvLyDmiJbogIXvvIzlj6/ku6XpgJrov4fov5Tlm57kuIDkuKpyZWplY3Rpb27mnaXpmLvmraLkuIvkuIDmraVcclxuICAgICAgICAgICAgICAgIC8vIHJldHVybiAkcS5yZWplY3QocmVqZWN0aW9uKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgcmV0dXJuIGludGVyY2VwdG9yO1xyXG4gICAgfV0pXHJcbiAgICAuZmFjdG9yeSgnQXV0aEludGVyY2VwdG9yJywgWyckcm9vdFNjb3BlJywgJyRxJywgJyRjb29raWVzJywgJyRsb2NhdGlvbicsICckd2luZG93JywgJyR0aW1lb3V0JywgJyRsb2cnLCAnTE9HSU5fVVJMJywgZnVuY3Rpb24oJHJvb3RTY29wZSwgJHEsICRjb29raWVzLCAkbG9jYXRpb24sICR3aW5kb3csICR0aW1lb3V0LCAkbG9nLCBMT0dJTl9VUkwpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXF1ZXN0OiBmdW5jdGlvbihjb25maWcpIHtcclxuICAgICAgICAgICAgICAgIC8vIGRlbGV0ZSAkcm9vdFNjb3BlLmVycm9yS2V5O1xyXG4gICAgICAgICAgICAgICAgY29uZmlnLmhlYWRlcnNbXCJsb2NhdGlvblwiXSA9ICRsb2NhdGlvbi5hYnNVcmwoKTtcclxuICAgICAgICAgICAgICAgIGNvbmZpZy5oZWFkZXJzID0gY29uZmlnLmhlYWRlcnMgfHwge307XHJcbiAgICAgICAgICAgICAgICAkbG9nLmluZm8oJ1gtQVVUSC1UT0tFTicsICRjb29raWVzLmdldCgnWC1BVVRILVRPS0VOJykpO1xyXG4gICAgICAgICAgICAgICAgaWYgKCRjb29raWVzLmdldCgnWC1BVVRILVRPS0VOJykpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25maWcuaGVhZGVyc1snWC1BVVRILVRPS0VOJ10gPSAkY29va2llcy5nZXQoJ1gtQVVUSC1UT0tFTicpO1xyXG4gICAgICAgICAgICAgICAgICAgIC8vIGNvbmZpZy5oZWFkZXJzWydYLUFVVEgtRU1BSUwnXSA9ICRjb29raWVzLmVtYWlsO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpZztcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgcmVzcG9uc2VFcnJvcjogZnVuY3Rpb24ocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIHZhciBzdGF0dXMgPSByZXNwb25zZS5zdGF0dXM7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gdXNlciBpcyBub3QgYXV0aGVudGljYXRlZCAtPiByZWRpcmVjdFxyXG4gICAgICAgICAgICAgICAgaWYgKHN0YXR1cyA9PT0gNDAxKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGxvY2F0aW9uID0gcmVzcG9uc2UuaGVhZGVycygnbG9jYXRpb24nKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgLy8gaWYgKGxvY2F0aW9uKSBsb2NhdGlvbiA9IGVuY29kZVVSSShsb2NhdGlvbik7IC8vIHdhcm46IGVuY29kZVVSSShudWxsKSA9PT0gJ251bGwnXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGxvY2F0aW9uKSBsb2NhdGlvbiA9IGVuY29kZVVSSUNvbXBvbmVudChsb2NhdGlvbik7IC8vIHdhcm46IGVuY29kZVVSSShudWxsKSA9PT0gJ251bGwnXHJcbiAgICAgICAgICAgICAgICAgICAgJHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gTE9HSU5fVVJMICsgKCEhbG9jYXRpb24gPyAnP3JlZGlyZWN0VVJMPScgKyBsb2NhdGlvbiA6ICcnKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBpZ25vcmUgZm9ybSB2YWxpZGF0aW9uIGVycm9ycyBiZWNhdXNlIHRoZXJlIGFyZSBoYW5kbGVkIGluIHRoZSBzcGVjaWZpYyBjb250cm9sbGVyXHJcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHN0YXR1cyAhPT0gMCAmJiBhbmd1bGFyLmlzVW5kZWZpbmVkKHJlc3BvbnNlLmRhdGEuZXJyb3JzKSkge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICAvLyBzZXJ2ZXIgZXJyb3JcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZGF0YS50ZXh0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuZXJyb3JLZXkgPSByZXNwb25zZS5kYXRhLnRleHQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS5zaG93RXJyb3JNc2cgPSB0cnVlOyAvLyBnZW5lcmFsIGVycm9yIG1lc3NhZ2VcclxuICAgICAgICAgICAgICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLnNob3dFcnJvck1zZyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCA1MDAwKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgcmV0dXJuICRxLnJlamVjdChyZXNwb25zZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfV0pXHJcbiAgICAuZmFjdG9yeSgnYXV0aFNlcnZpY2UnLCBbJyRodHRwJywgZnVuY3Rpb24oJGh0dHApIHtcclxuICAgICAgICB2YXIgdXNlclJvbGUgPSBbXTsgLy8gb2J0YWluZWQgZnJvbSBiYWNrZW5kXHJcbiAgICAgICAgdmFyIHVzZXJSb2xlUm91dGVNYXAgPSB7XHJcbiAgICAgICAgICAgICdST0xFX0FETUlOJzogWycvZGFzaGJvYXJkJywgJy9hYm91dC11cycsICcvYXV0aEVycm9yJ10sXHJcbiAgICAgICAgICAgICdST0xFX1VTRVInOiBbJy91c2Vyc2V0dGluZ3MnLCAnL3VzZXJzZXR0aW5ncy9wZXJzb25hbCcsICcvYXV0aEVycm9yJ11cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICB1c2VyTG9nZ2VkSW46IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHVzZXJIYXNSb2xlOiBmdW5jdGlvbihyb2xlKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHVzZXJSb2xlLmxlbmd0aDsgaisrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJvbGUgPT0gdXNlclJvbGVbal0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBpc1VybEFjY2Vzc2libGVGb3JVc2VyOiBmdW5jdGlvbihyb3V0ZSkge1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB1c2VyUm9sZS5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciByb2xlID0gdXNlclJvbGVbaV07XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZhbGlkVXJsc0ZvclJvbGUgPSB1c2VyUm9sZVJvdXRlTWFwW3JvbGVdO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWxpZFVybHNGb3JSb2xlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgdmFsaWRVcmxzRm9yUm9sZS5sZW5ndGg7IGorKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbGlkVXJsc0ZvclJvbGVbal0gPT0gcm91dGUpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfV0pXHJcbiAgICAvLyAuY29uZmlnKFsnJGNvb2tpZXNQcm92aWRlcicsIGZ1bmN0aW9uKCRjb29raWVzUHJvdmlkZXIpIHtcclxuICAgIC8vICAgICAvLyAkaHR0cC5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vbltcIlgtQVVUSC1UT0tFTlwiXSA9ICRjb29raWVzWydBVVRILVRPS0VOJ107XHJcbiAgICAvLyB9XSlcclxuICAgIC5jb25maWcoWyckaHR0cFByb3ZpZGVyJywgZnVuY3Rpb24oJGh0dHBQcm92aWRlcikge1xyXG4gICAgICAgICRodHRwUHJvdmlkZXIuZGVmYXVsdHMuaGVhZGVycy5jb21tb25bJ3gtUmVxdWVzdGVkLVdpdGgnXSA9ICdYTUxIdHRwUmVxdWVzdCc7XHJcbiAgICAgICAgLy8gJGh0dHBQcm92aWRlci5pbnRlcmNlcHRvcnMucHVzaCgnSHR0cEludGVyY2VwdG9yJyk7XHJcbiAgICAgICAgJGh0dHBQcm92aWRlci5pbnRlcmNlcHRvcnMucHVzaCgnQXV0aEludGVyY2VwdG9yJyk7XHJcbiAgICB9XSlcclxuICAgIC5jb25maWcoWyckcm91dGVQcm92aWRlcicsICckbG9jYXRpb25Qcm92aWRlcicsIGZ1bmN0aW9uKCRyb3V0ZVByb3ZpZGVyLCAkbG9jYXRpb25Qcm92aWRlcikge1xyXG4gICAgICAgIC8vIGh0bWw16Lev55Sx5qih5byPXHJcbiAgICAgICAgLy8gJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHRydWUpLmhhc2hQcmVmaXgoJyEnKTtcclxuICAgICAgICAkcm91dGVQcm92aWRlci53aGVuKCcvJywge1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9hcHAvdmlld3MvaG9tZS5odG1sJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ0hvbWVDb250cm9sbGVyJ1xyXG4gICAgICAgIH0pLndoZW4oJy9sb2dpbicsIHtcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYXBwL3ZpZXdzL2xvZ2luLmh0bWwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnTG9naW5Db250cm9sbGVyJ1xyXG4gICAgICAgIH0pLndoZW4oJy9oZWxwJywge1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9hcHAvdmlld3MvaGVscC5odG1sJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ0hlbHBDb250cm9sbGVyJ1xyXG4gICAgICAgIH0pLndoZW4oJy9ub3QtZm91bmQnLCB7XHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2FwcC92aWV3cy9ub3RfZm91bmQuaHRtbCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdOb3RGb3VuZENvbnRyb2xsZXInXHJcbiAgICAgICAgfSkub3RoZXJ3aXNlKHtcclxuICAgICAgICAgICAgcmVkaXJlY3RUbzogJy8nXHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgfV0pXHJcbiAgICAvLyAuY29uZmlnKFsnJGh0dHBQcm92aWRlcicsICckY2FjaGVGYWN0b3J5JywgZnVuY3Rpb24oJGh0dHBQcm92aWRlciwgJGNhY2hlRmFjdG9yeSkge1xyXG4gICAgLy8gICAgICRodHRwUHJvdmlkZXIuZGVmYXVsdHMuY2FjaGUgPSAkY2FjaGVGYWN0b3J5KCdscnUnLCB7XHJcbiAgICAvLyAgICAgICAgIGNhcGFjaXR5OiAxMDBcclxuICAgIC8vICAgICB9KTtcclxuICAgIC8vIH1dKVxyXG4gICAgLnJ1bihbJyRyb290U2NvcGUnLCAnJGxvY2F0aW9uJywgJyRsb2cnLCAnJGludGVydmFsJywgJ0F1dGhTZXJ2aWNlJywgZnVuY3Rpb24oJHJvb3RTY29wZSwgJGxvY2F0aW9uLCAkbG9nLCAkaW50ZXJ2YWwsIEF1dGhTZXJ2aWNlKSB7XHJcbiAgICAgICAgdmFyIE5Qcm9ncmVzc1RpbWVyO1xyXG4gICAgICAgICRyb290U2NvcGUuJG9uKCdwYWdlOmZldGNoJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIE5Qcm9ncmVzcy5yZW1vdmUoKTtcclxuICAgICAgICAgICAgTlByb2dyZXNzLnN0YXJ0KCk7XHJcblxyXG4gICAgICAgICAgICAkaW50ZXJ2YWwuY2FuY2VsKE5Qcm9ncmVzc1RpbWVyKTtcclxuICAgICAgICAgICAgTlByb2dyZXNzVGltZXIgPSAkaW50ZXJ2YWwoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICBOUHJvZ3Jlc3MuaW5jKCk7XHJcbiAgICAgICAgICAgIH0sIDUwMCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICRyb290U2NvcGUuJG9uKCdwYWdlOmNoYW5nZScsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAkaW50ZXJ2YWwuY2FuY2VsKE5Qcm9ncmVzc1RpbWVyKTtcclxuICAgICAgICAgICAgTlByb2dyZXNzLmRvbmUoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gcm91dGUgZXZlbnRcclxuICAgICAgICAkcm9vdFNjb3BlLiRvbignJHJvdXRlQ2hhbmdlU3RhcnQnLCBmdW5jdGlvbihldnQsIG5leHQsIGN1cnJlbnQpIHtcclxuICAgICAgICAgICAgJHJvb3RTY29wZS4kZW1pdCgncGFnZTpmZXRjaCcpO1xyXG5cclxuICAgICAgICAgICAgLy8gaWYgKCFhdXRoU2VydmljZS5pc1VybEFjY2Vzc2libGVGb3JVc2VyKG5leHQub3JpZ2luYWxQYXRoKSlcclxuICAgICAgICAgICAgLy8gICAgICRsb2NhdGlvbi5wYXRoKCcvYXV0aEVycm9yJyk7XHJcblxyXG4gICAgICAgICAgICAkbG9nLmluZm8oJyRyb3V0ZUNoYW5nZVN0YXJ0Jyk7XHJcbiAgICAgICAgICAgIC8vIOWmguaenOeUqOaIt+acqueZu+W9lVxyXG4gICAgICAgICAgICBpZiAoIUF1dGhTZXJ2aWNlLnVzZXJMb2dnZWRJbigpKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAobmV4dC50ZW1wbGF0ZVVybCA9PT0gXCJsb2dpbi5odG1sXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyDlt7Lnu4/ovazlkJHnmbvlvZXot6/nlLHlm6DmraTml6DpnIDph43lrprlkJFcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9sb2dpbicpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICRyb290U2NvcGUuJG9uKCckcm91dGVDaGFuZ2VTdWNjZXNzJywgZnVuY3Rpb24oZXZ0LCBuZXh0LCBwcmV2aW91cykge1xyXG4gICAgICAgICAgICAkcm9vdFNjb3BlLiRlbWl0KCdwYWdlOmNoYW5nZScpO1xyXG4gICAgICAgICAgICAkbG9nLmluZm8oJyRyb3V0ZUNoYW5nZVN1Y2Nlc3MnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgJHJvb3RTY29wZS4kb24oJyRyb3V0ZUNoYW5nZUVycm9yJywgZnVuY3Rpb24oY3VycmVudCwgcHJldmlvdXMsIHJlamVjdGlvbiwgZXJyb3IpIHtcclxuICAgICAgICAgICAgJHJvb3RTY29wZS4kZW1pdCgncGFnZTpjaGFuZ2UnKTtcclxuICAgICAgICAgICAgJGxvZy5lcnJvcihwcmV2aW91cy50ZW1wbGF0ZVVybCk7XHJcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvaG9tZScpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAkcm9vdFNjb3BlLiRvbignZG9vZy5zYXknLCBmdW5jdGlvbihldnQsIGRhdGEpIHtcclxuICAgICAgICAgICAgJGxvZy5pbmZvKGV2dC5uYW1lICsgJyAnICsgZGF0YSk7XHJcbiAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnZG9nZS5zYXknLCAnR08nKTtcclxuICAgICAgICAgICAgJHJvb3RTY29wZS4kZW1pdCgncm9vdDpzYXknKTtcclxuICAgICAgICB9KTtcclxuICAgIH1dKTtcclxuIiwiO1xuYW5ndWxhci5tb2R1bGUoJ2Rvb2cubGlicmFyeS13d3cnKS5jb250cm9sbGVyKCdIZWxwQ29udHJvbGxlcicsIFsnJHNjb3BlJywgJyRsb2cnLCAnJGxvY2F0aW9uJywgJ0Jvb2tTZXJ2aWNlJywgZnVuY3Rpb24oJHNjb3BlLCAkbG9nLCAkbG9jYXRpb24sIEJvb2tTZXJ2aWNlKSB7XG4gICAgJHNjb3BlLnRpdGxlID0gJ0hlbHAnO1xuXG4gICAgJHNjb3BlLiRvbignZG9vZy5zYXknLCBmdW5jdGlvbigpIHtcbiAgICAgICAgJGxvZy5pbmZvKCfmiJHlkKzliLAgaGFoYeS6huOAgmhlbHAuJHNjb3BlJyk7XG4gICAgfSlcblxuICAgICRzY29wZS4kb24oJ2RvZ2Uuc2F5JywgZnVuY3Rpb24oZXZ0LCBkYXRhKSB7XG4gICAgICAgICRsb2cuaW5mbyhldnQubmFtZSArICcgJyArIGRhdGEpO1xuICAgIH0pO1xuXG4gICAgJHNjb3BlLiRvbigncm9vdDpzYXknLCBmdW5jdGlvbihldnQsIGRhdGEpIHtcbiAgICAgICAgJGxvZy5pbmZvKGV2dC5uYW1lICsgJyAnICsgZGF0YSk7XG4gICAgfSk7XG5cbiAgICAkc2NvcGUubmV4dCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAkbG9jYXRpb24uc2VhcmNoKHtcbiAgICAgICAgICAgIHN0YXJ0OiBuZXcgRGF0ZSgpLmdldFRpbWUoKSxcbiAgICAgICAgICAgIHNpemU6IDEwXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgICRzY29wZS5sb2FkID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIEJvb2tTZXJ2aWNlLmV4cHJlc3MoZnVuY3Rpb24oYm9va0xpc3QpIHtcbiAgICAgICAgICAgICRsb2cuaW5mbyhib29rTGlzdC5sZW5ndGgpO1xuICAgICAgICB9KTtcbiAgICB9XG59XSk7XG4iLCI7XG5hbmd1bGFyLm1vZHVsZSgnZG9vZy5saWJyYXJ5LXd3dycpLmNvbnRyb2xsZXIoJ0hvbWVDb250cm9sbGVyJywgWyckc2NvcGUnLCAnJGxvY2F0aW9uJywgJyRsb2cnLCAnQm9va1NlcnZpY2UnLCAnVXNlclNlcnZpY2UnLCBmdW5jdGlvbigkc2NvcGUsICRsb2NhdGlvbiwgJGxvZywgQm9va1NlcnZpY2UsIFVzZXJTZXJ2aWNlKSB7XG4gICAgJHNjb3BlLnRpdGxlID0gJ0hvbWUnO1xuICAgICRzY29wZS5leHByZXNzQm9va3MgPSBbXTtcbiAgICAkc2NvcGUucG9wdWxhckJvb2tzID0gW107XG5cbiAgICBVc2VyU2VydmljZS5nZXQoe2lkOiAnNzc4OCd9LCBmdW5jdGlvbiAodXNlcikge1xuICAgICAgICAkc2NvcGUudXNlciA9IHVzZXI7XG4gICAgfSk7XG5cbiAgICBCb29rU2VydmljZS5leHByZXNzKGZ1bmN0aW9uKGJvb2tMaXN0KSB7XG4gICAgICAgICRzY29wZS5leHByZXNzQm9va3MgPSBib29rTGlzdDtcbiAgICB9KTtcblxuICAgIEJvb2tTZXJ2aWNlLnBvcHVsYXIoZnVuY3Rpb24oYm9va0xpc3QpIHtcbiAgICAgICAgJHNjb3BlLnBvcHVsYXJCb29rcyA9IGJvb2tMaXN0O1xuICAgIH0pO1xuXG5cbiAgICAkc2NvcGUubG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBCb29rU2VydmljZS5leHByZXNzKGZ1bmN0aW9uKGJvb2tMaXN0KSB7XG4gICAgICAgICAgICAkbG9nLmluZm8oYm9va0xpc3QubGVuZ3RoKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gcm91dGUgZXZlbnRcbiAgICAkc2NvcGUuJG9uKCckcm91dGVDaGFuZ2VTdGFydCcsIGZ1bmN0aW9uKGV2dCwgbmV4dCwgY3VycmVudCkge1xuICAgICAgICBjb25zb2xlLmxvZygnJHNjb3BlICRyb3V0ZUNoYW5nZVN0YXJ0Jyk7XG4gICAgfSk7XG5cbiAgICAkc2NvcGUuc2F5ID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICRzY29wZS4kZW1pdCgnZG9vZy5zYXknLCAnaGFoYX4nKTtcbiAgICB9XG5cbiAgICAkc2NvcGUuJG9uKCdkb29nLnNheScsIGZ1bmN0aW9uKCkge1xuICAgICAgICAkbG9nLmluZm8oJ+aIkeWQrOWIsCBoYWhh5LqG44CCaG9tZS4kc2NvcGUnKTtcbiAgICB9KTtcblxuICAgICRzY29wZS4kb24oJ2RvZ2Uuc2F5JywgZnVuY3Rpb24oZXZ0LCBkYXRhKSB7XG4gICAgICAgICRsb2cuaW5mbyhldnQubmFtZSArICcgJyArIGRhdGEpO1xuICAgIH0pO1xuXG4gICAgJHNjb3BlLiRvbigncm9vdDpzYXknLCBmdW5jdGlvbihldnQsIGRhdGEpIHtcbiAgICAgICAgJGxvZy5pbmZvKGV2dC5uYW1lICsgJyAnICsgZGF0YSk7XG4gICAgfSk7XG59XSk7XG4iLCI7XG5hbmd1bGFyLm1vZHVsZSgnZG9vZy5saWJyYXJ5LXd3dycpLmNvbnRyb2xsZXIoJ0xvZ2luQ29udHJvbGxlcicsIFsnJHNjb3BlJywgJyRsb2NhdGlvbicsICckbG9nJywgZnVuY3Rpb24oJHNjb3BlLCAkbG9jYXRpb24sICRsb2cpIHtcbiAgICAkbG9nLmluZm8oJ2xvY2F0aW9uLnVybDogJyArICRsb2NhdGlvbi51cmwoKSk7XG4gICAgJGxvZy5pbmZvKCdsb2NhdGlvbi5wYXRoOiAnICsgJGxvY2F0aW9uLnBhdGgoKSk7XG4gICAgJGxvZy5pbmZvKCdsb2NhdGlvbi5hYnNVcmw6ICcgKyAkbG9jYXRpb24uYWJzVXJsKCkpO1xuICAgICRzY29wZS50aXRsZSA9ICdMb2dpbic7XG5cbiAgICAkc2NvcGUuJG9uKCdkb29nLnNheScsIGZ1bmN0aW9uKCkge1xuICAgICAgICAkbG9nLmluZm8oJ+aIkeWQrOWIsCBoYWhh5LqG44CCbG9naW4uJHNjb3BlJyk7XG4gICAgfSk7XG5cbiAgICAkc2NvcGUuJG9uKCdkb2dlLnNheScsIGZ1bmN0aW9uKGV2dCwgZGF0YSkge1xuICAgICAgICAkbG9nLmluZm8oZXZ0Lm5hbWUgKyAnICcgKyBkYXRhKTtcbiAgICB9KTtcblxuICAgICRzY29wZS4kb24oJ3Jvb3Q6c2F5JywgZnVuY3Rpb24oZXZ0LCBkYXRhKSB7XG4gICAgICAgICRsb2cuaW5mbyhldnQubmFtZSArICcgJyArIGRhdGEpO1xuICAgIH0pO1xufV0pO1xuIiwiO1xuYW5ndWxhci5tb2R1bGUoJ2Rvb2cubGlicmFyeS13d3cnKS5jb250cm9sbGVyKCdOb3RGb3VuZENvbnRyb2xsZXInLCBbJyRzY29wZScsICckbG9nJywgZnVuY3Rpb24oJHNjb3BlLCAkbG9nKSB7XG4gICAgJHNjb3BlLnRpdGxlID0gJ05vdEZvdW5kJztcblxuICAgICRzY29wZS4kb24oJ2Rvb2cuc2F5JywgZnVuY3Rpb24oKSB7XG4gICAgICAgICRsb2cuaW5mbygn5oiR5ZCs5YiwIGhhaGHkuobjgIJub3RfZm91bmQuJHNjb3BlJyk7XG4gICAgfSk7XG5cbiAgICAkc2NvcGUuJG9uKCdkb2dlLnNheScsIGZ1bmN0aW9uKGV2dCwgZGF0YSkge1xuICAgICAgICAkbG9nLmluZm8oZXZ0Lm5hbWUgKyAnICcgKyBkYXRhKTtcbiAgICB9KTtcblxuICAgICRzY29wZS4kb24oJ3Jvb3Q6c2F5JywgZnVuY3Rpb24oZXZ0LCBkYXRhKSB7XG4gICAgICAgICRsb2cuaW5mbyhldnQubmFtZSArICcgJyArIGRhdGEpO1xuICAgIH0pO1xufV0pO1xuIiwiYW5ndWxhci5tb2R1bGUoJ2Rvb2cubGlicmFyeS13d3cnKS5kaXJlY3RpdmUoJ215QWNjZXNzJywgWydhdXRoU2VydmljZScsICdyZW1vdmVFbGVtZW50JywgZnVuY3Rpb24oYXV0aFNlcnZpY2UsIHJlbW92ZUVsZW1lbnQpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICByZXN0cmljdDogJ0EnLFxuICAgICAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWxlbWVudCwgYXR0cmlidXRlcykge1xuICAgICAgICAgICAgdmFyIGhhc0FjY2VzcyA9IGZhbHNlO1xuICAgICAgICAgICAgdmFyIGFsbG93ZWRBY2Nlc3MgPSBhdHRyaWJ1dGVzLm15QWNjZXNzLnNwbGl0KFwiIFwiKTtcbiAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBhbGxvd2VkQWNjZXNzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgaWYgKGF1dGhTZXJ2aWNlLnVzZXJIYXNSb2xlKGFsbG93ZWRBY2Nlc3NbaV0pKSB7XG4gICAgICAgICAgICAgICAgICAgIGhhc0FjY2VzcyA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCFoYXNBY2Nlc3MpIHtcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2goZWxlbWVudC5jaGlsZHJlbigpLCBmdW5jdGlvbihjaGlsZCkge1xuICAgICAgICAgICAgICAgICAgICByZW1vdmVFbGVtZW50KGNoaWxkKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZW1vdmVFbGVtZW50KGVsZW1lbnQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH1cbiAgICB9XG59XSkuY29uc3RhbnQoJ3JlbW92ZUVsZW1lbnQnLCBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgZWxlbWVudCAmJiBlbGVtZW50LnJlbW92ZSAmJiBlbGVtZW50LnJlbW92ZSgpO1xufSk7XG4iLCI7XG5hbmd1bGFyLm1vZHVsZSgnZG9vZy5saWJyYXJ5LXd3dycpLnNlcnZpY2UoJ0F1dGhTZXJ2aWNlJywgWyckaHR0cCcsIGZ1bmN0aW9uKCRodHRwKSB7XG4gICAgdGhpcy51c2VyTG9nZ2VkSW4gPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxufV0pO1xuIiwiO1xuYW5ndWxhci5tb2R1bGUoJ2Rvb2cubGlicmFyeS13d3cnKS5mYWN0b3J5KCdCb29rU2VydmljZScsIFsnJHJlc291cmNlJywgZnVuY3Rpb24oJHJlc291cmNlKSB7XG4gICAgcmV0dXJuICRyZXNvdXJjZSgnL2FwcC9kYXRhL2Jvb2tzLmpzb24nLCB7XG4gICAgICAgIGlkOiBcIkBJZFwiXG4gICAgfSwge1xuICAgICAgICAvLyDmlrDkuaZcbiAgICAgICAgZXhwcmVzczoge1xuICAgICAgICAgICAgdXJsOiAnL2FwcC9kYXRhL2Jvb2tzLWV4cHJlc3MuanNvbicsXG4gICAgICAgICAgICBpc0FycmF5OiB0cnVlLFxuICAgICAgICAgICAgcGFyYW1zOiB7XG4gICAgICAgICAgICAgICAgcTogJ+Wuq+W0jumqjydcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgLy8g54Ot5qacXG4gICAgICAgIHBvcHVsYXI6IHtcbiAgICAgICAgICAgIHVybDogJy9hcHAvZGF0YS9ib29rcy1leHByZXNzLmpzb24nLFxuICAgICAgICAgICAgaXNBcnJheTogdHJ1ZSxcbiAgICAgICAgICAgIHBhcmFtczoge1xuICAgICAgICAgICAgICAgIHE6ICflrqvltI7pqo8nXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcbn1dKTtcbiIsIjtcbmFuZ3VsYXIubW9kdWxlKCdkb29nLmxpYnJhcnktd3d3JykuZmFjdG9yeSgnVXNlclNlcnZpY2UnLCBbJyRyZXNvdXJjZScsIGZ1bmN0aW9uKCRyZXNvdXJjZSkge1xuICAgIHJldHVybiAkcmVzb3VyY2UoJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMC91c2Vycy86aWQnLCB7XG4gICAgICAgIGlkOiBcIkBJZFwiXG4gICAgfSk7XG59XSk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=